<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Channel Manager - Rocker Interface</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #17a2b8;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }
        
        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(to right, var(--primary), #9b59b6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .logo span {
            font-size: 0.9rem;
            color: var(--gray);
            display: block;
            margin-top: 5px;
        }
        
        .status-bar {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255,255,255,0.05);
            padding: 10px 15px;
            border-radius: 8px;
            min-width: 120px;
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .status-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .status-online {
            color: var(--success);
        }
        
        .status-offline {
            color: var(--danger);
        }
        
        nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 10px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 12px 24px;
            background: transparent;
            color: var(--light);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .content-section {
            display: none;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .section-header h2 {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background: #d68910;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .table-container {
            overflow-x: auto;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 1px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        thead {
            background: rgba(255,255,255,0.1);
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        tr:hover {
            background: rgba(255,255,255,0.03);
        }
        
        .channel-logo {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            object-fit: cover;
            background: rgba(255,255,255,0.1);
            padding: 5px;
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }
        
        .badge-danger {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .badge-info {
            background: rgba(23, 162, 184, 0.2);
            color: #17a2b8;
        }
        
        .badge-warning {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .action-btn.delete:hover {
            background: var(--danger);
        }
        
        .action-btn.edit:hover {
            background: var(--warning);
        }
        
        .action-btn.play:hover {
            background: var(--success);
        }
        
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 12px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: white;
            font-size: 1rem;
        }
        
        .search-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .filter-select {
            padding: 12px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: white;
            font-size: 1rem;
            min-width: 150px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: transparent;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--light);
            font-weight: 500;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: white;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: monospace;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.2);
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--success);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .toggle-label {
            margin-bottom: 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.08);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .alert-success {
            background: rgba(39, 174, 96, 0.2);
            border-left: 4px solid var(--success);
            color: #27ae60;
        }
        
        .alert-error {
            background: rgba(231, 76, 60, 0.2);
            border-left: 4px solid var(--danger);
            color: #e74c3c;
        }
        
        .alert-warning {
            background: rgba(243, 156, 18, 0.2);
            border-left: 4px solid var(--warning);
            color: #f39c12;
        }
        
        .alert-info {
            background: rgba(23, 162, 184, 0.2);
            border-left: 4px solid var(--info);
            color: #17a2b8;
        }
        
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .m3u-url-box {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            word-break: break-all;
        }
        
        .m3u-url-box a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .m3u-url-box a:hover {
            text-decoration: underline;
        }
        
        .playlist-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .sync-success {
            color: var(--success);
        }
        
        .sync-error {
            color: var(--danger);
        }
        
        .sync-pending {
            color: var(--warning);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--light);
        }
        
        .copy-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }
        
        .copy-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        @media (max-width: 768px) {
            .status-bar {
                flex-wrap: wrap;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .search-input {
                min-width: 100%;
            }
            
            .modal-content {
                padding: 20px;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <i class="fas fa-tv"></i>
                <div>
                    <h1>IPTV Channel Manager</h1>
                    <span>Complete M3U8 Management Interface</span>
                </div>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-value" id="server-status">...</div>
                    <div class="status-label">Server Status</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="channel-count">0</div>
                    <div class="status-label">Channels</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="playlist-count">0</div>
                    <div class="status-label">Playlists</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="db-status">...</div>
                    <div class="status-label">Database</div>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav>
            <button class="nav-btn active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="nav-btn" data-section="channels">
                <i class="fas fa-tv"></i> Channels
            </button>
            <button class="nav-btn" data-section="playlists">
                <i class="fas fa-list"></i> Playlists
            </button>
            <button class="nav-btn" data-section="add-channel">
                <i class="fas fa-plus-circle"></i> Add Channel
            </button>
            <button class="nav-btn" data-section="add-playlist">
                <i class="fas fa-cloud-download-alt"></i> Add Playlist
            </button>
            <button class="nav-btn" data-section="m3u-generator">
                <i class="fas fa-file-export"></i> M3U Generator
            </button>
            <button class="nav-btn" data-section="bulk-import">
                <i class="fas fa-upload"></i> Bulk Import
            </button>
        </nav>
        
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                <button class="btn btn-primary" onclick="refreshStats()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <div class="stats-grid" id="stats-container">
                <!-- Stats will be loaded here -->
                <div class="empty-state">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Loading statistics...</h3>
                    <p>Please wait while we fetch your data</p>
                </div>
            </div>
            
            <div class="section-header">
                <h2><i class="fas fa-history"></i> Recent Activity</h2>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Channel</th>
                            <th>Group</th>
                            <th>Status</th>
                            <th>Last Updated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recent-channels">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px;">
                                Loading recent channels...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="m3u-url-box">
                <h3><i class="fas fa-link"></i> Quick Access M3U URL</h3>
                <p id="m3u-url">Loading...</p>
                <div class="playlist-actions">
                    <button class="btn btn-primary" onclick="copyM3UUrl()">
                        <i class="fas fa-copy"></i> Copy URL
                    </button>
                    <a href="/api/playlist.m3u" target="_blank" class="btn btn-success">
                        <i class="fas fa-external-link-alt"></i> Open in New Tab
                    </a>
                    <button class="btn btn-info" onclick="downloadM3U()">
                        <i class="fas fa-download"></i> Download M3U
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Channels Section -->
        <section id="channels" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-tv"></i> Manage Channels</h2>
                <div>
                    <button class="btn btn-danger" onclick="deleteAllChannels()" style="margin-right: 10px;">
                        <i class="fas fa-trash-alt"></i> Delete All
                    </button>
                    <button class="btn btn-primary" onclick="loadChannels()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="search-bar">
                <input type="text" id="channel-search" class="search-input" placeholder="Search channels by name, tvg-id, or group..." onkeyup="filterChannels()">
                <select id="group-filter" class="filter-select" onchange="filterChannels()">
                    <option value="">All Groups</option>
                </select>
                <select id="status-filter" class="filter-select" onchange="filterChannels()">
                    <option value="">All Status</option>
                    <option value="active">Active Only</option>
                    <option value="inactive">Inactive Only</option>
                </select>
                <button class="btn btn-info" onclick="resetFilters()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th width="50">Logo</th>
                            <th>Channel Name</th>
                            <th>TVG ID</th>
                            <th>Group</th>
                            <th>DRM</th>
                            <th>M3U8</th>
                            <th>Status</th>
                            <th width="150">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="channels-table">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px;">
                                Loading channels...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="section-header" style="margin-top: 30px;">
                <h2><i class="fas fa-filter"></i> Channel Groups</h2>
            </div>
            
            <div id="groups-container" style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px;">
                <!-- Groups will be loaded here -->
            </div>
        </section>
        
        <!-- Playlists Section -->
        <section id="playlists" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-list"></i> Manage Playlists</h2>
                <div>
                    <button class="btn btn-success" onclick="syncAllPlaylists()" style="margin-right: 10px;">
                        <i class="fas fa-sync-alt"></i> Sync All
                    </button>
                    <button class="btn btn-primary" onclick="loadPlaylists()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Playlist Name</th>
                            <th>URL</th>
                            <th>Channels</th>
                            <th>Auto Sync</th>
                            <th>Last Sync</th>
                            <th>Status</th>
                            <th width="250">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="playlists-table">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px;">
                                Loading playlists...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Add Channel Section -->
        <section id="add-channel" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-plus-circle"></i> Add New Channel</h2>
            </div>
            
            <div id="add-channel-alert" style="display: none;"></div>
            
            <form id="add-channel-form">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="channel-title">Channel Title *</label>
                            <input type="text" id="channel-title" class="form-input" placeholder="Enter channel name" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="channel-tvgid">TVG ID *</label>
                            <input type="text" id="channel-tvgid" class="form-input" placeholder="Unique identifier (or auto-generate)" value="channel_${Date.now()}">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="channel-url">Stream URL *</label>
                            <input type="text" id="channel-url" class="form-input" placeholder="http://example.com/stream.m3u8" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="channel-m3u8">M3U8 Fallback URL</label>
                            <input type="text" id="channel-m3u8" class="form-input" placeholder="Optional backup M3U8 URL">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="channel-group">Group Title</label>
                            <input type="text" id="channel-group" class="form-input" placeholder="General" value="General">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="channel-logo">Logo URL</label>
                            <input type="text" id="channel-logo" class="form-input" placeholder="http://example.com/logo.png">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="channel-key">DRM License Key</label>
                            <input type="text" id="channel-key" class="form-input" placeholder="Clearkey license key">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="channel-cookie">Cookie</label>
                            <input type="text" id="channel-cookie" class="form-input" placeholder="Authentication cookie">
                        </div>
                    </div>
                </div>
                
                <div class="form-group toggle-container">
                    <label class="toggle-label">Active Status</label>
                    <label class="switch">
                        <input type="checkbox" id="channel-active" checked>
                        <span class="slider"></span>
                    </label>
                    <span id="active-status-text">Active</span>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-warning" onclick="resetChannelForm()">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Channel
                    </button>
                </div>
            </form>
        </section>
        
        <!-- Add Playlist Section -->
        <section id="add-playlist" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-cloud-download-alt"></i> Add New Playlist</h2>
            </div>
            
            <div id="add-playlist-alert" style="display: none;"></div>
            
            <form id="add-playlist-form">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="playlist-name">Playlist Name *</label>
                            <input type="text" id="playlist-name" class="form-input" placeholder="My IPTV Playlist" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="playlist-url">Playlist URL *</label>
                            <input type="text" id="playlist-url" class="form-input" placeholder="http://example.com/playlist.m3u" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="playlist-sync-interval">Sync Interval (hours)</label>
                            <input type="number" id="playlist-sync-interval" class="form-input" min="1" max="168" value="1">
                            <small style="color: var(--gray);">How often to auto-sync (1-168 hours)</small>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group toggle-container">
                            <label class="toggle-label">Auto Sync</label>
                            <label class="switch">
                                <input type="checkbox" id="playlist-auto-sync" checked>
                                <span class="slider"></span>
                            </label>
                            <span id="auto-sync-text">Enabled</span>
                        </div>
                        
                        <div class="form-group toggle-container" style="margin-top: 15px;">
                            <label class="toggle-label">Active</label>
                            <label class="switch">
                                <input type="checkbox" id="playlist-active" checked>
                                <span class="slider"></span>
                            </label>
                            <span id="playlist-active-text">Active</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-warning" onclick="resetPlaylistForm()">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save & Sync Playlist
                    </button>
                </div>
            </form>
        </section>
        
        <!-- M3U Generator Section -->
        <section id="m3u-generator" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-file-export"></i> M3U Playlist Generator</h2>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="m3u-group-filter">Filter by Group</label>
                        <select id="m3u-group-filter" class="form-input">
                            <option value="">All Groups</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group toggle-container">
                        <label class="toggle-label">Use M3U8 Fallback URLs</label>
                        <label class="switch">
                            <input type="checkbox" id="use-m3u8-fallback">
                            <span class="slider"></span>
                        </label>
                        <span id="m3u8-fallback-text">Disabled</span>
                    </div>
                </div>
            </div>
            
            <div class="m3u-url-box">
                <h3><i class="fas fa-link"></i> Generated M3U URL</h3>
                <p id="generated-m3u-url">Select options above to generate URL</p>
                <div class="playlist-actions">
                    <button class="btn btn-primary" onclick="copyGeneratedM3UUrl()">
                        <i class="fas fa-copy"></i> Copy URL
                    </button>
                    <button class="btn btn-success" onclick="openGeneratedM3U()" id="open-m3u-btn" disabled>
                        <i class="fas fa-external-link-alt"></i> Open M3U
                    </button>
                    <button class="btn btn-info" onclick="downloadGeneratedM3U()" id="download-m3u-btn" disabled>
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
            
            <div class="section-header" style="margin-top: 30px;">
                <h2><i class="fas fa-info-circle"></i> Usage Instructions</h2>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px;">
                <h4>For IPTV Players:</h4>
                <p>1. Copy the generated URL above</p>
                <p>2. In your IPTV player (TiviMate, IPTV Smarters, VLC, etc.), add this URL as a new playlist</p>
                <p>3. The player will automatically load all your channels</p>
                
                <h4 style="margin-top: 20px;">Direct Links:</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><a href="/api/playlist.m3u" target="_blank">/api/playlist.m3u</a> - All active channels</li>
                    <li><a href="/api/playlist.m3u?useM3u8=true" target="_blank">/api/playlist.m3u?useM3u8=true</a> - Use M3U8 fallback URLs</li>
                </ul>
            </div>
        </section>
        
        <!-- Bulk Import Section -->
        <section id="bulk-import" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-upload"></i> Bulk Import from M3U</h2>
            </div>
            
            <div id="bulk-import-alert" style="display: none;"></div>
            
            <div class="form-group">
                <label for="m3u-content">Paste M3U Content *</label>
                <textarea id="m3u-content" class="form-textarea" placeholder="#EXTM3U
#EXTINF:-1 tvg-id=&quot;channel1&quot; group-title=&quot;Movies&quot; tvg-logo=&quot;http://example.com/logo.png&quot;,Channel Name
#KODIPROP:inputstream.adaptive.license_key=your_license_key
#EXTHTTP:{&quot;cookie&quot;:&quot;your_cookie&quot;}
http://example.com/stream.m3u8

#EXTINF:-1 tvg-id=&quot;channel2&quot; group-title=&quot;Sports&quot;,Another Channel
http://example.com/stream2.m3u8" rows="15"></textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-warning" onclick="clearM3UContent()">
                    <i class="fas fa-trash-alt"></i> Clear
                </button>
                <button type="button" class="btn btn-success" onclick="importM3U()">
                    <i class="fas fa-upload"></i> Import M3U
                </button>
                <button type="button" class="btn btn-info" onclick="loadExampleM3U()">
                    <i class="fas fa-eye"></i> Load Example
                </button>
            </div>
            
            <div class="section-header" style="margin-top: 30px;">
                <h2><i class="fas fa-history"></i> Import Results</h2>
            </div>
            
            <div id="import-results" style="display: none;">
                <!-- Results will be shown here -->
            </div>
        </section>
    </div>
    
    <!-- Edit Channel Modal -->
    <div id="edit-channel-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Channel</h3>
                <button class="close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <div id="edit-channel-alert" style="display: none;"></div>
            <form id="edit-channel-form">
                <input type="hidden" id="edit-channel-id">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-channel-title">Channel Title *</label>
                            <input type="text" id="edit-channel-title" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-channel-tvgid">TVG ID *</label>
                            <input type="text" id="edit-channel-tvgid" class="form-input" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-channel-url">Stream URL *</label>
                            <input type="text" id="edit-channel-url" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-channel-m3u8">M3U8 Fallback URL</label>
                            <input type="text" id="edit-channel-m3u8" class="form-input">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-channel-group">Group Title</label>
                            <input type="text" id="edit-channel-group" class="form-input">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-channel-logo">Logo URL</label>
                            <input type="text" id="edit-channel-logo" class="form-input">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-channel-key">DRM License Key</label>
                            <input type="text" id="edit-channel-key" class="form-input">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-channel-cookie">Cookie</label>
                            <input type="text" id="edit-channel-cookie" class="form-input">
                        </div>
                    </div>
                </div>
                
                <div class="form-group toggle-container">
                    <label class="toggle-label">Active Status</label>
                    <label class="switch">
                        <input type="checkbox" id="edit-channel-active">
                        <span class="slider"></span>
                    </label>
                    <span id="edit-active-status-text">Active</span>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="deleteChannel()">
                        <i class="fas fa-trash-alt"></i> Delete Channel
                    </button>
                    <button type="button" class="btn btn-warning" onclick="closeEditModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Playlist Modal -->
    <div id="edit-playlist-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Playlist</h3>
                <button class="close-modal" onclick="closePlaylistModal()">&times;</button>
            </div>
            <div id="edit-playlist-alert" style="display: none;"></div>
            <form id="edit-playlist-form">
                <input type="hidden" id="edit-playlist-id">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-playlist-name">Playlist Name *</label>
                            <input type="text" id="edit-playlist-name" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-playlist-url">Playlist URL *</label>
                            <input type="text" id="edit-playlist-url" class="form-input" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-playlist-sync-interval">Sync Interval (hours)</label>
                            <input type="number" id="edit-playlist-sync-interval" class="form-input" min="1" max="168">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group toggle-container">
                            <label class="toggle-label">Auto Sync</label>
                            <label class="switch">
                                <input type="checkbox" id="edit-playlist-auto-sync">
                                <span class="slider"></span>
                            </label>
                            <span id="edit-auto-sync-text">Enabled</span>
                        </div>
                        
                        <div class="form-group toggle-container" style="margin-top: 15px;">
                            <label class="toggle-label">Active</label>
                            <label class="switch">
                                <input type="checkbox" id="edit-playlist-active">
                                <span class="slider"></span>
                            </label>
                            <span id="edit-playlist-active-text">Active</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="deletePlaylist()">
                        <i class="fas fa-trash-alt"></i> Delete Playlist
                    </button>
                    <button type="button" class="btn btn-warning" onclick="closePlaylistModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Base URL for API
        const API_BASE = window.location.origin;
        let allChannels = [];
        let allPlaylists = [];
        let allGroups = [];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            checkServerStatus();
            loadStats();
            loadChannels();
            loadPlaylists();
            loadGroups();
            updateM3UUrl();
            
            // Update groups in filter dropdowns
            setInterval(() => {
                updateGroupFilters();
            }, 10000);
        });
        
        // Setup event listeners
        function setupEventListeners() {
            // Navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
                    this.classList.add('active');
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });
            
            // Toggle switches
            document.getElementById('channel-active').addEventListener('change', function() {
                document.getElementById('active-status-text').textContent = this.checked ? 'Active' : 'Inactive';
            });
            
            document.getElementById('edit-channel-active').addEventListener('change', function() {
                document.getElementById('edit-active-status-text').textContent = this.checked ? 'Active' : 'Inactive';
            });
            
            document.getElementById('playlist-auto-sync').addEventListener('change', function() {
                document.getElementById('auto-sync-text').textContent = this.checked ? 'Enabled' : 'Disabled';
            });
            
            document.getElementById('playlist-active').addEventListener('change', function() {
                document.getElementById('playlist-active-text').textContent = this.checked ? 'Active' : 'Inactive';
            });
            
            document.getElementById('edit-playlist-auto-sync').addEventListener('change', function() {
                document.getElementById('edit-auto-sync-text').textContent = this.checked ? 'Enabled' : 'Disabled';
            });
            
            document.getElementById('edit-playlist-active').addEventListener('change', function() {
                document.getElementById('edit-playlist-active-text').textContent = this.checked ? 'Active' : 'Inactive';
            });
            
            document.getElementById('use-m3u8-fallback').addEventListener('change', function() {
                document.getElementById('m3u8-fallback-text').textContent = this.checked ? 'Enabled' : 'Disabled';
                updateGeneratedM3UUrl();
            });
            
            document.getElementById('m3u-group-filter').addEventListener('change', updateGeneratedM3UUrl);
            
            // Forms
            document.getElementById('add-channel-form').addEventListener('submit', addChannel);
            document.getElementById('add-playlist-form').addEventListener('submit', addPlaylist);
            document.getElementById('edit-channel-form').addEventListener('submit', updateChannel);
            document.getElementById('edit-playlist-form').addEventListener('submit', updatePlaylist);
            
            // Channel search
            document.getElementById('channel-search').addEventListener('input', filterChannels);
        }
        
        // Check server status
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                document.getElementById('server-status').textContent = 'Online';
                document.getElementById('server-status').className = 'status-value status-online';
                document.getElementById('db-status').textContent = data.mongodb === 'connected' ? 'Connected' : 'Disconnected';
                document.getElementById('db-status').className = data.mongodb === 'connected' ? 'status-value status-online' : 'status-value status-offline';
            } catch (error) {
                document.getElementById('server-status').textContent = 'Offline';
                document.getElementById('server-status').className = 'status-value status-offline';
                document.getElementById('db-status').textContent = 'Unknown';
                document.getElementById('db-status').className = 'status-value status-offline';
                console.error('Server status check failed:', error);
            }
        }
        
        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/api/stats`);
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.data;
                    
                    document.getElementById('channel-count').textContent = stats.totalChannels;
                    document.getElementById('playlist-count').textContent = stats.totalPlaylists;
                    
                    const statsContainer = document.getElementById('stats-container');
                    statsContainer.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-icon" style="color: #3498db;">
                                <i class="fas fa-tv"></i>
                            </div>
                            <div class="stat-value">${stats.totalChannels}</div>
                            <div class="stat-label">Total Channels</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="color: #27ae60;">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-value">${stats.activeChannels}</div>
                            <div class="stat-label">Active Channels</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="color: #9b59b6;">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <div class="stat-value">${stats.totalGroups}</div>
                            <div class="stat-label">Channel Groups</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="color: #e74c3c;">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="stat-value">${stats.channelsWithDRM}</div>
                            <div class="stat-label">DRM Channels</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="color: #f39c12;">
                                <i class="fas fa-backup"></i>
                            </div>
                            <div class="stat-value">${stats.channelsWithM3u8Fallback}</div>
                            <div class="stat-label">M3U8 Fallback</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="color: #17a2b8;">
                                <i class="fas fa-list"></i>
                            </div>
                            <div class="stat-value">${stats.totalPlaylists}</div>
                            <div class="stat-label">Playlists</div>
                        </div>
                    `;
                    
                    // Update recent channels
                    updateRecentChannels();
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
                showAlert('stats-container', 'Failed to load statistics. Please try again.', 'error');
            }
        }
        
        // Refresh stats
        function refreshStats() {
            loadStats();
            showAlert('dashboard', 'Statistics refreshed!', 'success');
        }
        
        // Load channels
        async function loadChannels() {
            try {
                const response = await fetch(`${API_BASE}/api/channels`);
                const data = await response.json();
                
                if (data.success) {
                    allChannels = data.data;
                    displayChannels(allChannels);
                    updateGroupFilters();
                }
            } catch (error) {
                console.error('Failed to load channels:', error);
                showAlert('channels', 'Failed to load channels. Please try again.', 'error');
            }
        }
        
        // Display channels in table
        function displayChannels(channels) {
            const tbody = document.getElementById('channels-table');
            
            if (channels.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            <div class="empty-state">
                                <i class="fas fa-tv"></i>
                                <h3>No Channels Found</h3>
                                <p>Add your first channel using the "Add Channel" tab</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = '';
            
            channels.forEach(channel => {
                const row = document.createElement('tr');
                
                const hasDRM = channel.key ? 'Yes' : 'No';
                const hasM3U8 = channel.m3u8Url ? 'Yes' : 'No';
                const status = channel.isActive ? 'Active' : 'Inactive';
                
                row.innerHTML = `
                    <td>
                        ${channel.logo ? 
                            `<img src="${channel.logo}" alt="${channel.title}" class="channel-logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHJ4PSI2IiBmaWxsPSIjMzQ5OERCIi8+PHRleHQgeD0iMjAiIHk9IjIwIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0Ij5UVjwvdGV4dD48L3N2Zz4=';">` : 
                            `<div class="channel-logo" style="display: flex; align-items: center; justify-content: center; background: #3498db; color: white; font-weight: bold;">TV</div>`
                        }
                    </td>
                    <td>
                        <strong>${channel.title}</strong>
                        ${channel.sourcePlaylistId ? '<br><small style="color: var(--gray); font-size: 0.8rem;">Imported from playlist</small>' : ''}
                    </td>
                    <td><code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">${channel.tvgId}</code></td>
                    <td><span class="badge badge-info">${channel.groupTitle}</span></td>
                    <td><span class="badge ${channel.key ? 'badge-warning' : 'badge-info'}">${hasDRM}</span></td>
                    <td><span class="badge ${channel.m3u8Url ? 'badge-success' : 'badge-info'}">${hasM3U8}</span></td>
                    <td><span class="badge ${channel.isActive ? 'badge-success' : 'badge-danger'}">${status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit" onclick="openEditChannel('${channel._id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="confirmDeleteChannel('${channel._id}', '${channel.title}')" title="Delete">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            <button class="action-btn play" onclick="testChannel('${channel.url}')" title="Test Stream">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="action-btn" onclick="copyChannelUrl('${channel.url}')" title="Copy URL">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Filter channels
        function filterChannels() {
            const searchTerm = document.getElementById('channel-search').value.toLowerCase();
            const groupFilter = document.getElementById('group-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            
            let filtered = allChannels;
            
            if (searchTerm) {
                filtered = filtered.filter(channel => 
                    channel.title.toLowerCase().includes(searchTerm) ||
                    channel.tvgId.toLowerCase().includes(searchTerm) ||
                    channel.groupTitle.toLowerCase().includes(searchTerm)
                );
            }
            
            if (groupFilter) {
                filtered = filtered.filter(channel => channel.groupTitle === groupFilter);
            }
            
            if (statusFilter === 'active') {
                filtered = filtered.filter(channel => channel.isActive);
            } else if (statusFilter === 'inactive') {
                filtered = filtered.filter(channel => !channel.isActive);
            }
            
            displayChannels(filtered);
        }
        
        // Reset filters
        function resetFilters() {
            document.getElementById('channel-search').value = '';
            document.getElementById('group-filter').value = '';
            document.getElementById('status-filter').value = '';
            displayChannels(allChannels);
        }
        
        // Load groups
        async function loadGroups() {
            try {
                const response = await fetch(`${API_BASE}/api/groups`);
                const data = await response.json();
                
                if (data.success) {
                    allGroups = data.data;
                    updateGroupFilters();
                    displayGroups();
                }
            } catch (error) {
                console.error('Failed to load groups:', error);
            }
        }
        
        // Display groups
        function displayGroups() {
            const container = document.getElementById('groups-container');
            
            if (allGroups.length === 0) {
                container.innerHTML = '<p>No groups found</p>';
                return;
            }
            
            container.innerHTML = '';
            
            allGroups.forEach(group => {
                const groupChannels = allChannels.filter(c => c.groupTitle === group);
                const activeChannels = groupChannels.filter(c => c.isActive).length;
                
                const groupDiv = document.createElement('div');
                groupDiv.style.cssText = `
                    background: rgba(255,255,255,0.05);
                    padding: 15px;
                    border-radius: 8px;
                    min-width: 200px;
                    flex: 1;
                `;
                
                groupDiv.innerHTML = `
                    <h4 style="margin-bottom: 10px; color: var(--primary);">${group}</h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: var(--gray);">Channels:</span>
                        <span style="font-weight: bold;">${groupChannels.length}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="color: var(--gray);">Active:</span>
                        <span style="color: var(--success); font-weight: bold;">${activeChannels}</span>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="filterByGroup('${group}')">
                        <i class="fas fa-filter"></i> Filter Group
                    </button>
                `;
                
                container.appendChild(groupDiv);
            });
        }
        
        // Filter by group
        function filterByGroup(group) {
            document.getElementById('group-filter').value = group;
            document.querySelector('.nav-btn[data-section="channels"]').click();
            filterChannels();
        }
        
        // Update group filters in dropdowns
        function updateGroupFilters() {
            const groupSelect = document.getElementById('group-filter');
            const m3uGroupSelect = document.getElementById('m3u-group-filter');
            
            // Get unique groups from channels
            const groups = [...new Set(allChannels.map(c => c.groupTitle))].sort();
            
            // Update channel filter
            groupSelect.innerHTML = '<option value="">All Groups</option>';
            groups.forEach(group => {
                groupSelect.innerHTML += `<option value="${group}">${group}</option>`;
            });
            
            // Update M3U generator filter
            m3uGroupSelect.innerHTML = '<option value="">All Groups</option>';
            groups.forEach(group => {
                m3uGroupSelect.innerHTML += `<option value="${group}">${group}</option>`;
            });
        }
        
        // Load playlists
        async function loadPlaylists() {
            try {
                const response = await fetch(`${API_BASE}/api/playlists`);
                const data = await response.json();
                
                if (data.success) {
                    allPlaylists = data.data;
                    displayPlaylists(allPlaylists);
                }
            } catch (error) {
                console.error('Failed to load playlists:', error);
                showAlert('playlists', 'Failed to load playlists. Please try again.', 'error');
            }
        }
        
        // Display playlists
        function displayPlaylists(playlists) {
            const tbody = document.getElementById('playlists-table');
            
            if (playlists.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <div class="empty-state">
                                <i class="fas fa-list"></i>
                                <h3>No Playlists Found</h3>
                                <p>Add your first playlist using the "Add Playlist" tab</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = '';
            
            playlists.forEach(playlist => {
                const row = document.createElement('tr');
                
                const lastSync = playlist.lastSyncAt ? 
                    new Date(playlist.lastSyncAt).toLocaleString() : 'Never';
                const statusClass = playlist.lastSyncStatus === 'success' ? 'sync-success' : 
                                  playlist.lastSyncStatus === 'error' ? 'sync-error' : 'sync-pending';
                
                row.innerHTML = `
                    <td><strong>${playlist.name}</strong></td>
                    <td><code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; max-width: 300px; display: inline-block; overflow: hidden; text-overflow: ellipsis;">${playlist.url}</code></td>
                    <td><span class="badge badge-info">${playlist.channelCount}</span></td>
                    <td>
                        <span class="badge ${playlist.autoSync ? 'badge-success' : 'badge-warning'}">
                            ${playlist.autoSync ? 'Yes' : 'No'}
                        </span>
                    </td>
                    <td>${lastSync}</td>
                    <td>
                        <div class="sync-status">
                            <i class="fas fa-circle ${statusClass}"></i>
                            <span class="${statusClass}">${playlist.lastSyncStatus || 'Pending'}</span>
                        </div>
                        ${playlist.lastSyncMessage ? `<small style="color: var(--gray); display: block; margin-top: 5px;">${playlist.lastSyncMessage}</small>` : ''}
                    </td>
                    <td>
                        <div class="playlist-actions">
                            <button class="btn btn-sm btn-success" onclick="syncPlaylist('${playlist._id}')">
                                <i class="fas fa-sync-alt"></i> Sync
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="openEditPlaylist('${playlist._id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="confirmDeletePlaylist('${playlist._id}', '${playlist.name}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Add channel
        async function addChannel(e) {
            e.preventDefault();
            
            const channelData = {
                title: document.getElementById('channel-title').value,
                tvgId: document.getElementById('channel-tvgid').value,
                url: document.getElementById('channel-url').value,
                m3u8Url: document.getElementById('channel-m3u8').value,
                groupTitle: document.getElementById('channel-group').value,
                logo: document.getElementById('channel-logo').value,
                key: document.getElementById('channel-key').value,
                cookie: document.getElementById('channel-cookie').value,
                isActive: document.getElementById('channel-active').checked
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/channels`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(channelData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('add-channel', 'Channel added successfully!', 'success');
                    resetChannelForm();
                    loadChannels();
                    loadStats();
                    updateM3UUrl();
                } else {
                    showAlert('add-channel', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showAlert('add-channel', 'Failed to add channel. Please try again.', 'error');
                console.error('Error adding channel:', error);
            }
        }
        
        // Reset channel form
        function resetChannelForm() {
            document.getElementById('add-channel-form').reset();
            document.getElementById('channel-tvgid').value = `channel_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            document.getElementById('channel-group').value = 'General';
            document.getElementById('channel-active').checked = true;
            document.getElementById('active-status-text').textContent = 'Active';
        }
        
        // Add playlist
        async function addPlaylist(e) {
            e.preventDefault();
            
            const playlistData = {
                name: document.getElementById('playlist-name').value,
                url: document.getElementById('playlist-url').value,
                autoSync: document.getElementById('playlist-auto-sync').checked,
                syncInterval: parseInt(document.getElementById('playlist-sync-interval').value) * 3600000,
                isActive: document.getElementById('playlist-active').checked
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/playlists`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(playlistData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('add-playlist', 'Playlist added successfully!', 'success');
                    resetPlaylistForm();
                    loadPlaylists();
                    loadStats();
                    
                    // Auto-sync if enabled
                    if (data.syncResults) {
                        setTimeout(() => {
                            loadChannels();
                            showAlert('add-playlist', `Synced ${data.syncResults.added + data.syncResults.updated} channels from playlist`, 'info');
                        }, 1000);
                    }
                } else {
                    showAlert('add-playlist', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showAlert('add-playlist', 'Failed to add playlist. Please try again.', 'error');
                console.error('Error adding playlist:', error);
            }
        }
        
        // Reset playlist form
        function resetPlaylistForm() {
            document.getElementById('add-playlist-form').reset();
            document.getElementById('playlist-sync-interval').value = 1;
            document.getElementById('playlist-auto-sync').checked = true;
            document.getElementById('playlist-active').checked = true;
            document.getElementById('auto-sync-text').textContent = 'Enabled';
            document.getElementById('playlist-active-text').textContent = 'Active';
        }
        
        // Open edit channel modal
        async function openEditChannel(channelId) {
            try {
                const response = await fetch(`${API_BASE}/api/channels/${channelId}`);
                const data = await response.json();
                
                if (data.success) {
                    const channel = data.data;
                    
                    document.getElementById('edit-channel-id').value = channel._id;
                    document.getElementById('edit-channel-title').value = channel.title;
                    document.getElementById('edit-channel-tvgid').value = channel.tvgId;
                    document.getElementById('edit-channel-url').value = channel.url;
                    document.getElementById('edit-channel-m3u8').value = channel.m3u8Url;
                    document.getElementById('edit-channel-group').value = channel.groupTitle;
                    document.getElementById('edit-channel-logo').value = channel.logo;
                    document.getElementById('edit-channel-key').value = channel.key;
                    document.getElementById('edit-channel-cookie').value = channel.cookie;
                    document.getElementById('edit-channel-active').checked = channel.isActive;
                    document.getElementById('edit-active-status-text').textContent = channel.isActive ? 'Active' : 'Inactive';
                    
                    document.getElementById('edit-channel-modal').classList.add('active');
                }
            } catch (error) {
                console.error('Failed to load channel:', error);
                showAlert('channels', 'Failed to load channel details.', 'error');
            }
        }
        
        // Close edit modal
        function closeEditModal() {
            document.getElementById('edit-channel-modal').classList.remove('active');
            document.getElementById('edit-channel-alert').style.display = 'none';
        }
        
        // Update channel
        async function updateChannel(e) {
            e.preventDefault();
            
            const channelId = document.getElementById('edit-channel-id').value;
            const channelData = {
                title: document.getElementById('edit-channel-title').value,
                tvgId: document.getElementById('edit-channel-tvgid').value,
                url: document.getElementById('edit-channel-url').value,
                m3u8Url: document.getElementById('edit-channel-m3u8').value,
                groupTitle: document.getElementById('edit-channel-group').value,
                logo: document.getElementById('edit-channel-logo').value,
                key: document.getElementById('edit-channel-key').value,
                cookie: document.getElementById('edit-channel-cookie').value,
                isActive: document.getElementById('edit-channel-active').checked
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/channels/${channelId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(channelData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('edit-channel', 'Channel updated successfully!', 'success');
                    setTimeout(() => {
                        closeEditModal();
                        loadChannels();
                        loadStats();
                        updateM3UUrl();
                    }, 1000);
                } else {
                    showAlert('edit-channel', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showAlert('edit-channel', 'Failed to update channel. Please try again.', 'error');
                console.error('Error updating channel:', error);
            }
        }
        
        // Delete channel
        async function deleteChannel() {
            const channelId = document.getElementById('edit-channel-id').value;
            const channelName = document.getElementById('edit-channel-title').value;
            
            if (!confirm(`Are you sure you want to delete "${channelName}"?`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/channels/${channelId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('edit-channel', 'Channel deleted successfully!', 'success');
                    setTimeout(() => {
                        closeEditModal();
                        loadChannels();
                        loadStats();
                        updateM3UUrl();
                    }, 1000);
                } else {
                    showAlert('edit-channel', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showAlert('edit-channel', 'Failed to delete channel. Please try again.', 'error');
                console.error('Error deleting channel:', error);
            }
        }
        
        // Confirm delete channel
        function confirmDeleteChannel(channelId, channelName) {
            if (!confirm(`Are you sure you want to delete "${channelName}"?`)) {
                return;
            }
            
            fetch(`${API_BASE}/api/channels/${channelId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('channels', 'Channel deleted successfully!', 'success');
                    loadChannels();
                    loadStats();
                    updateM3UUrl();
                }
            })
            .catch(error => {
                console.error('Error deleting channel:', error);
                showAlert('channels', 'Failed to delete channel.', 'error');
            });
        }
        
        // Delete all channels
        function deleteAllChannels() {
            if (!confirm('Are you sure you want to delete ALL channels? This action cannot be undone!')) {
                return;
            }
            
            fetch(`${API_BASE}/api/channels`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('channels', `Deleted ${data.deletedCount} channels successfully!`, 'success');
                    loadChannels();
                    loadStats();
                    updateM3UUrl();
                }
            })
            .catch(error => {
                console.error('Error deleting all channels:', error);
                showAlert('channels', 'Failed to delete all channels.', 'error');
            });
        }
        
        // Open edit playlist modal
        async function openEditPlaylist(playlistId) {
            try {
                const response = await fetch(`${API_BASE}/api/playlists/${playlistId}`);
                const data = await response.json();
                
                if (data.success) {
                    const playlist = data.data;
                    
                    document.getElementById('edit-playlist-id').value = playlist._id;
                    document.getElementById('edit-playlist-name').value = playlist.name;
                    document.getElementById('edit-playlist-url').value = playlist.url;
                    document.getElementById('edit-playlist-sync-interval').value = playlist.syncInterval / 3600000;
                    document.getElementById('edit-playlist-auto-sync').checked = playlist.autoSync;
                    document.getElementById('edit-playlist-active').checked = playlist.isActive;
                    document.getElementById('edit-auto-sync-text').textContent = playlist.autoSync ? 'Enabled' : 'Disabled';
                    document.getElementById('edit-playlist-active-text').textContent = playlist.isActive ? 'Active' : 'Inactive';
                    
                    document.getElementById('edit-playlist-modal').classList.add('active');
                }
            } catch (error) {
                console.error('Failed to load playlist:', error);
                showAlert('playlists', 'Failed to load playlist details.', 'error');
            }
        }
        
        // Close playlist modal
        function closePlaylistModal() {
            document.getElementById('edit-playlist-modal').classList.remove('active');
            document.getElementById('edit-playlist-alert').style.display = 'none';
        }
        
        // Update playlist
        async function updatePlaylist(e) {
            e.preventDefault();
            
            const playlistId = document.getElementById('edit-playlist-id').value;
            const playlistData = {
                name: document.getElementById('edit-playlist-name').value,
                url: document.getElementById('edit-playlist-url').value,
                autoSync: document.getElementById('edit-playlist-auto-sync').checked,
                syncInterval: parseInt(document.getElementById('edit-playlist-sync-interval').value) * 3600000,
                isActive: document.getElementById('edit-playlist-active').checked
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/playlists/${playlistId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(playlistData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('edit-playlist', 'Playlist updated successfully!', 'success');
                    setTimeout(() => {
                        closePlaylistModal();
                        loadPlaylists();
                    }, 1000);
                } else {
                    showAlert('edit-playlist', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showAlert('edit-playlist', 'Failed to update playlist. Please try again.', 'error');
                console.error('Error updating playlist:', error);
            }
        }
        
        // Delete playlist
        async function deletePlaylist() {
            const playlistId = document.getElementById('edit-playlist-id').value;
            const playlistName = document.getElementById('edit-playlist-name').value;
            
            const deleteChannels = confirm(`Delete "${playlistName}"?\n\nDo you also want to delete all channels imported from this playlist?\n\nClick OK to delete channels, Cancel to keep them.`);
            
            const url = `${API_BASE}/api/playlists/${playlistId}?deleteChannels=${deleteChannels}`;
            
            try {
                const response = await fetch(url, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('edit-playlist', 'Playlist deleted successfully!', 'success');
                    setTimeout(() => {
                        closePlaylistModal();
                        loadPlaylists();
                        loadChannels();
                        loadStats();
                    }, 1000);
                } else {
                    showAlert('edit-playlist', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showAlert('edit-playlist', 'Failed to delete playlist. Please try again.', 'error');
                console.error('Error deleting playlist:', error);
            }
        }
        
        // Confirm delete playlist
        function confirmDeletePlaylist(playlistId, playlistName) {
            const deleteChannels = confirm(`Delete "${playlistName}"?\n\nDo you also want to delete all channels imported from this playlist?\n\nClick OK to delete channels, Cancel to keep them.`);
            
            const url = `${API_BASE}/api/playlists/${playlistId}?deleteChannels=${deleteChannels}`;
            
            fetch(url, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('playlists', 'Playlist deleted successfully!', 'success');
                    loadPlaylists();
                    loadChannels();
                    loadStats();
                }
            })
            .catch(error => {
                console.error('Error deleting playlist:', error);
                showAlert('playlists', 'Failed to delete playlist.', 'error');
            });
        }
        
        // Sync playlist
        function syncPlaylist(playlistId) {
            fetch(`${API_BASE}/api/playlists/${playlistId}/sync`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('playlists', `Playlist synced: ${data.results.added} added, ${data.results.updated} updated`, 'success');
                    setTimeout(() => {
                        loadPlaylists();
                        loadChannels();
                        loadStats();
                    }, 1000);
                } else {
                    showAlert('playlists', `Sync failed: ${data.message}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error syncing playlist:', error);
                showAlert('playlists', 'Failed to sync playlist.', 'error');
            });
        }
        
        // Sync all playlists
        function syncAllPlaylists() {
            if (!confirm('Sync all playlists? This may take a while.')) {
                return;
            }
            
            fetch(`${API_BASE}/api/playlists/sync-all`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('playlists', 'All playlists synced successfully!', 'success');
                    setTimeout(() => {
                        loadPlaylists();
                        loadChannels();
                        loadStats();
                    }, 2000);
                } else {
                    showAlert('playlists', `Sync failed: ${data.message}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error syncing all playlists:', error);
                showAlert('playlists', 'Failed to sync playlists.', 'error');
            });
        }
        
        // Update M3U URL
        function updateM3UUrl() {
            const m3uUrl = `${API_BASE}/api/playlist.m3u`;
            document.getElementById('m3u-url').innerHTML = `<a href="${m3uUrl}" target="_blank">${m3uUrl}</a>`;
        }
        
        // Update generated M3U URL
        function updateGeneratedM3UUrl() {
            const group = document.getElementById('m3u-group-filter').value;
            const useM3u8 = document.getElementById('use-m3u8-fallback').checked;
            
            let url = `${API_BASE}/api/playlist.m3u`;
            const params = [];
            
            if (group) {
                params.push(`groupTitle=${encodeURIComponent(group)}`);
            }
            
            if (useM3u8) {
                params.push('useM3u8=true');
            }
            
            if (params.length > 0) {
                url += '?' + params.join('&');
            }
            
            document.getElementById('generated-m3u-url').innerHTML = `<a href="${url}" target="_blank">${url}</a>`;
            
            const openBtn = document.getElementById('open-m3u-btn');
            const downloadBtn = document.getElementById('download-m3u-btn');
            openBtn.disabled = false;
            downloadBtn.disabled = false;
        }
        
        // Copy M3U URL
        function copyM3UUrl() {
            const url = `${API_BASE}/api/playlist.m3u`;
            copyToClipboard(url);
            showTempAlert('dashboard', 'M3U URL copied to clipboard!', 'success');
        }
        
        // Copy generated M3U URL
        function copyGeneratedM3UUrl() {
            const urlElement = document.getElementById('generated-m3u-url');
            const url = urlElement.querySelector('a')?.href || urlElement.textContent;
            copyToClipboard(url);
            showTempAlert('m3u-generator', 'M3U URL copied to clipboard!', 'success');
        }
        
        // Download M3U
        function downloadM3U() {
            window.open(`${API_BASE}/api/playlist.m3u`, '_blank');
        }
        
        // Download generated M3U
        function downloadGeneratedM3U() {
            const group = document.getElementById('m3u-group-filter').value;
            const useM3u8 = document.getElementById('use-m3u8-fallback').checked;
            
            let url = `${API_BASE}/api/playlist.m3u`;
            const params = [];
            
            if (group) {
                params.push(`groupTitle=${encodeURIComponent(group)}`);
            }
            
            if (useM3u8) {
                params.push('useM3u8=true');
            }
            
            if (params.length > 0) {
                url += '?' + params.join('&');
            }
            
            window.open(url, '_blank');
        }
        
        // Open generated M3U
        function openGeneratedM3U() {
            const urlElement = document.getElementById('generated-m3u-url');
            const url = urlElement.querySelector('a')?.href || urlElement.textContent;
            window.open(url, '_blank');
        }
        
        // Import M3U content
        async function importM3U() {
            const m3uContent = document.getElementById('m3u-content').value.trim();
            
            if (!m3uContent) {
                showAlert('bulk-import', 'Please paste M3U content first.', 'warning');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/channels/bulk`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ m3uContent })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const results = data.results;
                    const resultsDiv = document.getElementById('import-results');
                    
                    let resultsHtml = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <strong>Import Successful!</strong>
                                <p>Added: ${results.added}, Updated: ${results.updated}, Errors: ${results.errors}</p>
                            </div>
                        </div>
                    `;
                    
                    if (results.details.length > 0) {
                        resultsHtml += '<div class="table-container" style="margin-top: 20px;">';
                        resultsHtml += '<table><thead><tr><th>Status</th><th>Channel</th><th>TVG ID</th><th>Error</th></tr></thead><tbody>';
                        
                        results.details.forEach(detail => {
                            const statusClass = detail.status === 'added' ? 'badge-success' : 
                                              detail.status === 'updated' ? 'badge-warning' : 'badge-danger';
                            
                            resultsHtml += `
                                <tr>
                                    <td><span class="badge ${statusClass}">${detail.status}</span></td>
                                    <td>${detail.title || 'N/A'}</td>
                                    <td><code>${detail.tvgId || 'N/A'}</code></td>
                                    <td>${detail.error || ''}</td>
                                </tr>
                            `;
                        });
                        
                        resultsHtml += '</tbody></table></div>';
                    }
                    
                    resultsDiv.innerHTML = resultsHtml;
                    resultsDiv.style.display = 'block';
                    
                    showAlert('bulk-import', 'M3U content imported successfully!', 'success');
                    
                    // Refresh data
                    setTimeout(() => {
                        loadChannels();
                        loadStats();
                        updateM3UUrl();
                    }, 1000);
                } else {
                    showAlert('bulk-import', `Import failed: ${data.message}`, 'error');
                }
            } catch (error) {
                showAlert('bulk-import', 'Failed to import M3U content. Please try again.', 'error');
                console.error('Error importing M3U:', error);
            }
        }
        
        // Clear M3U content
        function clearM3UContent() {
            document.getElementById('m3u-content').value = '';
            document.getElementById('import-results').style.display = 'none';
        }
        
        // Load example M3U
        function loadExampleM3U() {
            const example = `#EXTM3U
#EXTINF:-1 tvg-id="example1" group-title="Movies" tvg-logo="https://example.com/logo1.png",Example Movie Channel
#KODIPROP:inputstream.adaptive.license_key=1234567890abcdef
#EXTHTTP:{"cookie":"session=abc123"}
http://example.com/stream1.m3u8

#EXTINF:-1 tvg-id="example2" group-title="Sports",Example Sports Channel
http://example.com/stream2.m3u8

#EXTINF:-1 tvg-id="example3" group-title="News",Example News Channel
http://example.com/stream3.m3u8`;
            
            document.getElementById('m3u-content').value = example;
        }
        
        // Test channel stream
        function testChannel(url) {
            if (url) {
                window.open(url, '_blank');
            } else {
                alert('No stream URL available for this channel.');
            }
        }
        
        // Copy channel URL
        function copyChannelUrl(url) {
            copyToClipboard(url);
            showTempAlert('channels', 'Channel URL copied to clipboard!', 'success');
        }
        
        // Update recent channels
        function updateRecentChannels() {
            const recentChannels = [...allChannels]
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                .slice(0, 5);
            
            const tbody = document.getElementById('recent-channels');
            
            if (recentChannels.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            No channels yet. Add your first channel!
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = '';
            
            recentChannels.forEach(channel => {
                const row = document.createElement('tr');
                const updated = new Date(channel.updatedAt).toLocaleString();
                
                row.innerHTML = `
                    <td>
                        <strong>${channel.title}</strong>
                        <br><small style="color: var(--gray);">${channel.tvgId}</small>
                    </td>
                    <td><span class="badge badge-info">${channel.groupTitle}</span></td>
                    <td><span class="badge ${channel.isActive ? 'badge-success' : 'badge-danger'}">${channel.isActive ? 'Active' : 'Inactive'}</span></td>
                    <td>${updated}</td>
                    <td>
                        <button class="action-btn edit" onclick="openEditChannel('${channel._id}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn play" onclick="testChannel('${channel.url}')" title="Test">
                            <i class="fas fa-play"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Utility: Copy to clipboard
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        
        // Utility: Show alert
        function showAlert(sectionId, message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <div>${message}</div>
            `;
            
            const container = document.getElementById(sectionId);
            const existingAlert = container.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            container.insertBefore(alertDiv, container.firstChild);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }
        
        // Utility: Show temporary alert
        function showTempAlert(sectionId, message, type) {
            showAlert(sectionId, message, type);
        }
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadStats();
        }, 30000);
        
        // Auto-refresh channels every minute
        setInterval(() => {
            loadChannels();
        }, 60000);
    </script>
</body>
</html>
